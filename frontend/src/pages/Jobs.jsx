import { useEffect, useState } from 'react';import { apiGet } from '../lib/api';import AdSlot from '../components/AdSlot';import { ADS } from '../lib/ads';import { GridCardSkeleton } from '../components/Skeleton';import Pagination from '../components/Pagination';import { useToast } from '../components/Toast';export default function Jobs(){const[items,setItems]=useState([]);const[search,setSearch]=useState('');const[loading,setLoading]=useState(false);const[page,setPage]=useState(1);const[pages,setPages]=useState(1);const limit=12;const toast=useToast();async function load(p=page,o={}){const s=o.search??search;setLoading(true);try{const data=await apiGet('/api/jobs',{search:s,page:p,limit});setItems(data.items);setPages(data.pages);setPage(data.page);if(!data.items.length)toast({variant:'info',title:'No results',description:'Try a broader search.'});}catch(e){toast({variant:'error',title:'Failed to load jobs',description:e.message});}finally{setLoading(false);}}useEffect(()=>{load(1);},[]);const searchNow=()=>load(1);const reset=()=>{setSearch('');load(1,{search:''});};return(<div className='grid gap-4'><h1 className='text-2xl font-bold'>Jobs</h1><AdSlot slot={ADS.jobs}/><div className='flex gap-2'><input className='border rounded px-3 py-2' placeholder='Search jobs' value={search} onChange={e=>setSearch(e.target.value)}/><button onClick={searchNow} className='px-4 py-2 rounded bg-black text-white'>Search</button><button onClick={reset} className='px-4 py-2 rounded border bg-white'>Reset</button></div>{loading?<GridCardSkeleton count={limit}/>:<><div className='grid sm:grid-cols-2 lg:grid-cols-3 gap-4'>{items.map(j=>(<div key={j._id} className='border rounded-xl p-4 bg-white hover:shadow-lg transition'><h3 className='font-bold'>{j.title}</h3>{j.postedAt&&<p className='text-xs text-gray-600'>{new Date(j.postedAt).toLocaleDateString()}</p>}<p className='text-sm mt-2'>{j.description}</p><a className='mt-3 inline-block underline text-blue-700' href={j.url} target='_blank' rel='noopener'>View on umucuruzi.com â†’</a></div>))}</div><Pagination page={page} pages={pages} onPageChange={p=>load(p)}/></>}</div>);}
