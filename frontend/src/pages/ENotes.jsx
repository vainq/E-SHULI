import { useEffect, useState } from 'react';import { apiGet } from '../lib/api';import AdSlot from '../components/AdSlot';import { ADS } from '../lib/ads';import { GridCardSkeleton } from '../components/Skeleton';import Pagination from '../components/Pagination';import { useToast } from '../components/Toast';export default function ENotes(){const[items,setItems]=useState([]);const[search,setSearch]=useState('');const[level,setLevel]=useState('');const[subject,setSubject]=useState('');const[loading,setLoading]=useState(false);const[page,setPage]=useState(1);const[pages,setPages]=useState(1);const limit=12;const toast=useToast();async function load(p=page,o={}){const s=o.search??search,l=o.level??level,sub=o.subject??subject;setLoading(true);try{const data=await apiGet('/api/e-notes',{search:s,level:l,subject:sub,page:p,limit});setItems(data.items);setPages(data.pages);setPage(data.page);if(!data.items.length)toast({variant:'info',title:'No results',description:'Adjust filters.'});}catch(e){toast({variant:'error',title:'Failed to load E-Notes',description:e.message});}finally{setLoading(false);}}useEffect(()=>{load(1);},[]);const apply=()=>load(1);const reset=()=>{setSearch('');setLevel('');setSubject('');load(1,{search:'',level:'',subject:''});};return(<div className='grid gap-4'><h1 className='text-2xl font-bold'>E-Notes</h1><AdSlot slot={ADS.enotes}/><div className='flex flex-wrap gap-2'><input className='border rounded px-3 py-2' placeholder='Search title' value={search} onChange={e=>setSearch(e.target.value)}/><select className='border rounded px-3 py-2' value={level} onChange={e=>setLevel(e.target.value)}><option value=''>All Levels</option><option>Secondary</option><option>TVET</option><option>University</option></select><input className='border rounded px-3 py-2' placeholder='Subject' value={subject} onChange={e=>setSubject(e.target.value)}/><button onClick={apply} className='px-4 py-2 rounded bg-black text-white'>Filter</button><button onClick={reset} className='px-4 py-2 rounded border bg-white'>Reset</button></div>{loading?<GridCardSkeleton count={limit}/>:<><div className='grid sm:grid-cols-2 lg:grid-cols-3 gap-4'>{items.map(n=>(<div key={n._id} className='border rounded-xl p-4 bg-white hover:shadow-lg transition'><h3 className='font-bold'>{n.title}</h3><p className='text-sm text-gray-600'>{n.subject} · {n.level}</p>{n.description&&<p className='text-sm mt-1'>{n.description}</p>}<a className='mt-2 inline-block underline text-blue-700' href={n.fileUrl} target='_blank'>Open →</a></div>))}</div><Pagination page={page} pages={pages} onPageChange={p=>load(p)}/></>}</div>);}
