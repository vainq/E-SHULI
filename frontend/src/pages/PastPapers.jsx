import { useEffect, useState } from 'react';import { apiGet } from '../lib/api';import AdSlot from '../components/AdSlot';import { ADS } from '../lib/ads';import { GridCardSkeleton } from '../components/Skeleton';import Pagination from '../components/Pagination';import { useToast } from '../components/Toast';export default function PastPapers(){const[items,setItems]=useState([]);const[search,setSearch]=useState('');const[level,setLevel]=useState('');const[year,setYear]=useState('');const[source,setSource]=useState('');const[loading,setLoading]=useState(false);const[page,setPage]=useState(1);const[pages,setPages]=useState(1);const limit=12;const toast=useToast();async function load(p=page,o={}){const s=o.search??search,l=o.level??level,y=o.year??year,src=o.source??source;setLoading(true);try{const data=await apiGet('/api/past-papers',{search:s,level:l,year:y,source:src,page:p,limit});setItems(data.items);setPages(data.pages);setPage(data.page);if(!data.items.length)toast({variant:'info',title:'No results',description:'Adjust filters.'});}catch(e){toast({variant:'error',title:'Failed to load past papers',description:e.message});}finally{setLoading(false);}}useEffect(()=>{load(1);},[]);const apply=()=>load(1);const reset=()=>{setSearch('');setLevel('');setYear('');setSource('');load(1,{search:'',level:'',year:'',source:''});};return(<div className='grid gap-4'><h1 className='text-2xl font-bold'>Past Papers</h1><AdSlot slot={ADS.papers}/><div className='flex flex-wrap gap-2'><input className='border rounded px-3 py-2' placeholder='Search title/subject' value={search} onChange={e=>setSearch(e.target.value)}/><select className='border rounded px-3 py-2' value={level} onChange={e=>setLevel(e.target.value)}><option value=''>All Levels</option><option>Secondary</option><option>TVET</option><option>University</option></select><input className='border rounded px-3 py-2' placeholder='Year e.g. 2023' value={year} onChange={e=>setYear(e.target.value)}/><select className='border rounded px-3 py-2' value={source} onChange={e=>setSource(e.target.value)}><option value=''>Any Source</option><option>REB</option><option>NESA</option><option>MINEDUC</option><option>Other</option></select><button onClick={apply} className='px-4 py-2 rounded bg-black text-white'>Filter</button><button onClick={reset} className='px-4 py-2 rounded border bg-white'>Reset</button></div>{loading?<GridCardSkeleton count={limit}/>:<><div className='grid sm:grid-cols-2 lg:grid-cols-3 gap-4'>{items.map(p=>(<div key={p._id} className='border rounded-xl p-4 bg-white hover:shadow-lg transition'><h3 className='font-bold'>{p.title}</h3><p className='text-sm text-gray-600'>{p.subject} · {p.year} · {p.level} · {p.source}</p><a className='mt-2 inline-block underline text-blue-700' href={p.url} target='_blank'>Open PDF →</a></div>))}</div><Pagination page={page} pages={pages} onPageChange={p=>load(p)}/></>}</div>);}
