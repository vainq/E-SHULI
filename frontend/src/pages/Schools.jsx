import { useEffect, useState } from 'react';import { apiGet } from '../lib/api';import { GridCardSkeleton } from '../components/Skeleton';import Pagination from '../components/Pagination';import { useToast } from '../components/Toast';import { RW_PROVINCES, RW_DISTRICTS } from '../data/rwanda';export default function Schools(){const[items,setItems]=useState([]);const[search,setSearch]=useState('');const[level,setLevel]=useState('');const[province,setProvince]=useState('');const[district,setDistrict]=useState('');const[loading,setLoading]=useState(false);const[page,setPage]=useState(1);const[pages,setPages]=useState(1);const limit=12;const toast=useToast();const districts=province?RW_DISTRICTS[province]||[]:[];async function load(p=page,o={}){const s=o.search??search,l=o.level??level,pr=o.province??province,d=o.district??district;setLoading(true);try{const data=await apiGet('/api/schools',{search:s,level:l,province:pr,district:d,page:p,limit});setItems(data.items);setPages(data.pages);setPage(data.page);if(!data.items.length)toast({variant:'info',title:'No results',description:'Try different filters.'});}catch(e){toast({variant:'error',title:'Failed to load schools',description:e.message});}finally{setLoading(false);}}useEffect(()=>{load(1);},[]);const applyFilters=()=>load(1);const reset=()=>{setSearch('');setLevel('');setProvince('');setDistrict('');load(1,{search:'',level:'',province:'',district:''});};const onProvinceChange=val=>{setProvince(val);setDistrict('');};return(<div className='grid gap-4'><h1 className='text-2xl font-bold'>Schools</h1><div className='flex flex-wrap gap-2'><input className='border rounded px-3 py-2' placeholder='Search by name' value={search} onChange={e=>setSearch(e.target.value)}/><select className='border rounded px-3 py-2' value={level} onChange={e=>setLevel(e.target.value)}><option value=''>All Levels</option><option>Secondary</option><option>TVET</option><option>University</option></select><select className='border rounded px-3 py-2' value={province} onChange={e=>onProvinceChange(e.target.value)}><option value=''>Province</option>{RW_PROVINCES.map(p=><option key={p} value={p}>{p}</option>)}</select><select className='border rounded px-3 py-2' value={district} onChange={e=>setDistrict(e.target.value)} disabled={!province}><option value=''>{province?'District':'Select province first'}</option>{districts.map(d=><option key={d} value={d}>{d}</option>)}</select><button onClick={applyFilters} className='px-4 py-2 rounded bg-black text-white'>Filter</button><button onClick={reset} className='px-4 py-2 rounded border bg-white'>Reset</button></div>{loading?<GridCardSkeleton count={limit}/>:(<><div className='grid sm:grid-cols-2 lg:grid-cols-3 gap-4'>{items.map(s=>(<div key={s._id} className='border rounded-xl p-4 hover:shadow-lg transition bg-white'><div className='flex items-center gap-3'>{s.badgeUrl&&<img src={s.badgeUrl} alt='' className='w-12 h-12 object-contain'/>}<div><h3 className='font-bold'>{s.name}</h3><p className='text-xs text-gray-600'>{s.level} · {s.province}, {s.district}, {s.sector}</p></div></div>{s.sizeRange&&<p className='text-sm mt-2'>Size: {s.sizeRange}</p>}{s.tuition?.amount&&<p className='text-sm'>Tuition: {s.tuition.amount} {s.currency} / {s.tuition.period}</p>}{s.uniformColors?.length?<p className='text-sm'>Uniform: {s.uniformColors.join(', ')}</p>:null}<div className='mt-2 flex gap-3 text-sm'>{s.website&&<a className='underline' href={s.website} target='_blank'>Website</a>}{s.contact?.phone&&<span>☎ {s.contact.phone}</span>}</div></div>))}</div><Pagination page={page} pages={pages} onPageChange={p=>load(p)}/></>)}</div>);}
