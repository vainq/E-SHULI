const{Router}=require('express');const School=require('../models/School');const{requireAuth}=require('../middleware/auth');const r=Router();r.get('/',async(req,res)=>{const{search,level,province,district,sector,page='1',limit='20'}=req.query;const q={};if(search)q.name={$regex:search,$options:'i'};if(level)q.level=level;if(province)q.province=province;if(district)q.district=district;if(sector)q.sector=sector;const p=Math.max(parseInt(page),1);const l=Math.max(parseInt(limit),1);const[items,total]=await Promise.all([School.find(q).sort({name:1}).skip((p-1)*l).limit(l),School.countDocuments(q)]);res.json({items,total,page:p,pages:Math.ceil(total/l)});});r.post('/',requireAuth,async(req,res)=>{const created=await School.create(req.body);res.json(created);});module.exports=r;
