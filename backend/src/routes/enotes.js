const{Router}=require('express');const ENote=require('../models/ENote');const{requireAuth}=require('../middleware/auth');const r=Router();r.get('/',async(req,res)=>{const{search,level,subject,page='1',limit='20'}=req.query;const q={};if(search)q.title={$regex:search,$options:'i'};if(level)q.level=level;if(subject)q.subject={$regex:subject,$options:'i'};const p=Math.max(parseInt(page),1);const l=Math.max(parseInt(limit),1);const[items,total]=await Promise.all([ENote.find(q).sort({createdAt:-1}).skip((p-1)*l).limit(l),ENote.countDocuments(q)]);res.json({items,total,page:p,pages:Math.ceil(total/l)});});r.post('/',requireAuth,async(req,res)=>{const created=await ENote.create(req.body);res.json(created);});module.exports=r;
