const fs=require('fs');const path=require('path');const{parse}=require('csv-parse/sync');const{connectDB}=require('../db');const School=require('../models/School');require('dotenv').config({path:path.resolve(__dirname,'../../.env')});(async()=>{try{const csvPath=process.argv[2];if(!csvPath){console.error('Usage: npm run import:schools -- ./path/to/schools.csv');process.exit(1);}await connectDB();const csv=fs.readFileSync(path.resolve(csvPath),'utf8');const rows=parse(csv,{columns:true,skip_empty_lines:true});let n=0;for(const r of rows){await School.updateOne({name:r.name,level:r.level,district:r.district},{$set:{name:r.name,level:r.level,province:r.province,district:r.district,sector:r.sector,sizeRange:r.sizeRange,tuition:{amount:Number(r.amount)||undefined,period:r.period},currency:r.currency||'RWF',uniformColors:(r.uniformColors||'').split('|').filter(Boolean),badgeUrl:r.badgeUrl,website:r.website,contact:{phone:r.phone,email:r.email}}},{upsert:true});n++;}console.log('Upserted:',n);process.exit(0);}catch(e){console.error(e);process.exit(1);}})();
