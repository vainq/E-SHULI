const express=require('express');const cors=require('cors');const{CONFIG}=require('./config');const{connectDB}=require('./db');const health=require('./routes/health');const debug=require('./routes/debug');const schools=require('./routes/schools');const pastPapers=require('./routes/pastPapers');const enotes=require('./routes/enotes');const jobs=require('./routes/jobs');const admin=require('./routes/admin');const cron=require('./routes/cron');const{publicLimiter,authLimiter,cronLimiter}=require('./middleware/rateLimit');(async function(){await connectDB();const app=express();app.use(express.json({limit:'2mb'}));app.use(cors({origin:CONFIG.CORS_ORIGIN.split(','),credentials:false}));app.use('/api',health);app.use('/api/debug',debug);app.use('/api/schools',publicLimiter,schools);app.use('/api/past-papers',publicLimiter,pastPapers);app.use('/api/e-notes',publicLimiter,enotes);app.use('/api/jobs',publicLimiter,jobs);app.use('/api/admin',authLimiter,admin);app.use('/api/cron',cronLimiter,cron);app.get('/',(_req,res)=>res.json({name:'E-SHULI API'}));app.listen(CONFIG.PORT,()=>console.log(`API listening on :${CONFIG.PORT}`));})().catch(e=>{console.error(e);process.exit(1);});
